"use strict";function $(t){return void 0===document.querySelectorAll(t)[1]?document.querySelector(t):document.querySelectorAll(t)}function attachEventListener(e,t,s){t.trim().split(" ").forEach(t=>{e.addEventListener(t,s)})}Array.prototype.shuffle=function(){for(let t=this.length;t;t--){var e=Math.floor(Math.random()*t);[this[t-1],this[e]]=[this[e],this[t-1]]}};let allCards=[],selectedElements=[],offsetX=0,offsetY=0;class Card{constructor(t,e){this.num=t,this.type=e}get numName(){return this._numToName(this.num)}get typeName(){return this._typeToName(this.type)}get element(){let t=document.createElement("div");t.classList.add("card"),t.classList.add(this.typeName[2]),t.setAttribute("data-num",this.num),t.setAttribute("data-type",this.type);var e="<span>".concat(this.numName," ").concat(this.typeName[1],"</span>");return t.innerHTML="".concat(e,'<div class="type">').concat(this.typeName[1],"</div>").concat(e),t}_numToName(t){if(!(1<=t&&t<=13))throw new Error("Num '".concat(this.num,"' does not exist"));switch(t){case 1:return"A";case 11:return"J";case 12:return"Q";case 13:return"K";default:return t}}_typeToName(t){switch(t){case 0:return["Hearts","♥","red"];case 1:return["Clubs","♣","black"];case 2:return["Diamonds","♦","red"];case 3:return["Spades","♠","black"];default:throw new Error("Card type '".concat(t,"' does not exist"))}}}function createCards(){for(let e=0;e<=3;e++)for(let t=1;t<=13;t++)allCards.push(new Card(t,e));allCards.shuffle()}function initStacks(){for(let e=1;e<8;e++){let t=document.createElement("div");t.classList.add("stack"),t.classList.add("stack_"+e),t.setAttribute("data-max",e),$(".stacks").appendChild(t)}for(var s of $(".stack")){var n=s.getAttribute("data-max");for(let e=0;e<n;e++){var a=allCards[0];allCards.splice(0,1);let t=a.element;e==n-1&&t.classList.add("open"),s.appendChild(t)}attachEventListener(s,"mouseup",function(){void 0!==selectedElements[0]&&onDrop(this)})}for(var t of allCards)$(".full").appendChild(t.element)}function _addSelectedElement(t){t.classList.add("selected"),selectedElements.push(t)}function _rmSelectedElements(){selectedElements[0];for(var t of selectedElements)t.classList.remove("selected");selectedElements=[]}function resetSelected(){selectedElements[0];for(var t of selectedElements)t.style.top="auto",t.style.left="auto";_rmSelectedElements()}function _moveElement(t,e){var s=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=t;t.parentNode.removeChild(t),s?e.insertBefore(n,e.firstChild):e.appendChild(n)}function updateElementPosition(t,e){var s=e.touches?e.touches[0].pageX:e.clientX,e=e.touches?e.touches[0].pageY:e.clientY;t.style.top=e-offsetY+"px",t.style.left=s-offsetX+"px"}function initDragAndDrop(){for(var t of $(".card"))attachEventListener(t,"mousedown touchstart",function(t){var e,s=t.target.getBoundingClientRect();if(offsetX=t.touches?t.touches[0].clientX-s.left:t.offsetX,offsetY=t.touches?t.touches[0].clientY-s.top:t.offsetY,this.parentNode.lastChild==this&&this.classList.add("open"),this.classList.contains("open")){let t=this;for(;t;)_addSelectedElement(t),t=t.nextElementSibling}for(e of selectedElements)updateElementPosition(e,t)});document.addEventListener("dblclick",autoMove),attachEventListener(document,"mouseup",function(){resetSelected()}),attachEventListener(document,"mousemove touchmove",function(t){selectedElements[0];for(var e of selectedElements)updateElementPosition(e,t)});for(var e of $(".foundations"))attachEventListener(e,"mouseup",function(){onDrop(this)});attachEventListener(document,"touchend",function(t){const{pageX:s,pageY:n}=t.changedTouches[0],a=["foundations","stack"],e=(()=>{let e=document.elementFromPoint(s,n);for(;e;){if(a.some(t=>e.classList.contains(t)))return e;e=e.parentElement}return e})();e&&(e.classList.contains("foundations")&&onDrop(e),e.classList.contains("stack")&&onDrop(e)),resetSelected()}),$(".full").addEventListener("click",function(){if(0<this.childNodes.length)this.lastChild.classList.add("open"),_moveElement(this.lastChild,$(".view"));else for(var t of $(".view .card"))t.classList.remove("open"),_moveElement(t,$(".full"),!0)})}function onDrop(t){selectedElements.length&&selectedElements.length+t.childNodes.length<=13&&(t.classList.contains("foundations")&&foundationCanStack(t)&&allowDrop(t),t.classList.contains("stack")&&stacksCanStack(t)&&allowDrop(t))}function allowDrop(e){for(var s of selectedElements){let t=s;s.parentNode.removeChild(s),e.appendChild(t),t.style.top="auto",t.style.left="auto"}_rmSelectedElements()}function foundationCanStack(t){return 0===t.childNodes.length?1===parseInt(selectedElements[0].getAttribute("data-num")):!(1<selectedElements.length)&&(parseInt(t.lastChild.getAttribute("data-type"))===parseInt(selectedElements[0].getAttribute("data-type"))?parseInt(t.lastChild.getAttribute("data-num"))+1===parseInt(selectedElements[0].getAttribute("data-num")):void 0)}function stacksCanStack(t){return 0===t.childNodes.length?13===parseInt(selectedElements[0].getAttribute("data-num")):parseInt(t.lastChild.getAttribute("data-num"))-1===parseInt(selectedElements[0].getAttribute("data-num"))?parseInt(t.lastChild.getAttribute("data-type"))%2!=parseInt(selectedElements[0].getAttribute("data-type"))%2:void 0}function autoMove(){for(var t of $(".stack"))for(var e of $(".foundations"))0<t.childNodes.length&&(0<e.childNodes.length?t.lastChild.getAttribute("data-type")===e.lastChild.getAttribute("data-type")&&parseInt(t.lastChild.getAttribute("data-num"))===parseInt(e.lastChild.getAttribute("data-num"))+1&&_moveElement(t.lastChild,e):1==t.lastChild.getAttribute("data-num")&&_moveElement(t.lastChild,e))}createCards(),initStacks(),initDragAndDrop();